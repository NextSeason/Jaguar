THREE.DeviceOrientationControls=function(a){function b(a,b){return function(){b.apply(a,arguments)}}this.object=a,this.object.rotation.reorder("YXZ"),this.freeze=!0,this.deviceOrientation={},this.screenOrientation=0,this.onDeviceOrientationChangeEvent=function(a){this.deviceOrientation=a},this.onScreenOrientationChangeEvent=function(){this.screenOrientation=window.orientation||0};var c=0,d=0,e=0;rb=rg=0,function(){var a=navigator.userAgent.replace(/\s/g,"").toLowerCase();return a.indexOf("htc802w")>-1?.05:.02}(),this.avg=function(a){for(var b={alpha:0,beta:0,gamma:0},c=0;c<a.length;c++)b.alpha+=a[c].alpha,b.beta+=a[c].beta,b.gamma+=a[c].gamma;var d={alpha:b.alpha/a.length,beta:b.beta/a.length,gamma:b.gamma/a.length};return d};var c,d,e,f,g=(beta=gamma=orient=0,new Array),h=0;this.x=0;var i=!0;this.setX=function(a){this.x=a},this.getX=function(){return this.x},this.update=function(){return function(){if(!this.freeze){var a=/ip(?=od|ad|hone)/i.test(navigator.userAgent),b=navigator.userAgent.replace(/\s/g,"").toLowerCase();if(a)c=this.deviceOrientation.alpha?THREE.Math.degToRad(this.deviceOrientation.alpha):0,d=this.deviceOrientation.beta?THREE.Math.degToRad(this.deviceOrientation.beta):0,e=this.deviceOrientation.gamma?THREE.Math.degToRad(this.deviceOrientation.gamma):0;else{if(b.indexOf("htc")>-1){if(!i)return;i=!1}(NaN==this.x||0==this.x)&&(this.x=this.deviceOrientation.alpha?this.deviceOrientation.alpha-50:0,this.x=0);var j=20;if(b.indexOf("htc")>-1)for(j=15;g.length>=j;)g.shift();b.indexOf("gt")>-1&&(j=10),g.length>=j&&g.shift();var k=this.deviceOrientation.alpha?this.deviceOrientation.alpha-this.x:0;k%=360,0>k&&(k+=360),g.push({alpha:b.indexOf("gt")>-1?this.deviceOrientation.alpha:k,beta:this.deviceOrientation.beta?this.deviceOrientation.beta:0,gamma:this.deviceOrientation.gamma?this.deviceOrientation.gamma:0});var l=this.avg(g);g.length>2?(h=g[g.length-2].alpha,g[g.length-1].alpha=Math.abs(g[g.length-1].alpha%360-g[g.length-2].alpha%360)>180?g[g.length-1].alpha<90?360*((g[g.length-2].alpha-g[g.length-2].alpha%360)/360+1)+g[g.length-1].alpha:g[g.length-2].alpha-g[g.length-2].alpha%360-(360-g[g.length-1].alpha):g[g.length-2].alpha-g[g.length-2].alpha%360+g[g.length-1].alpha):1==g.length&&(g[0]=3600+g[0]),l=this.avg(g),c=this.deviceOrientation.alpha?THREE.Math.degToRad(l.alpha):0,d=this.deviceOrientation.beta?THREE.Math.degToRad(l.beta):0,e=this.deviceOrientation.gamma?THREE.Math.degToRad(l.gamma):0}f=this.screenOrientation?THREE.Math.degToRad(this.screenOrientation):0;for(var m=0;m<g.length;m++);setObjectQuaternion(this.object.quaternion,c,d,e,f),b.indexOf("htc")>-1&&(i=!0)}}}(),this.connect=function(){this.onScreenOrientationChangeEvent(),window.addEventListener("orientationchange",b(this,this.onScreenOrientationChangeEvent),!1),window.addEventListener("deviceorientation",b(this,this.onDeviceOrientationChangeEvent),!1),this.freeze=!1},this.disconnect=function(){this.freeze=!0,window.removeEventListener("orientationchange",b(this,this.onScreenOrientationChangeEvent),!1),window.removeEventListener("deviceorientation",b(this,this.onDeviceOrientationChangeEvent),!1)},setObjectQuaternion=function(){var a=new THREE.Vector3(0,0,1),b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(e,f,g,h,i){b.set(g,f,-h,"YXZ"),e.setFromEuler(b),e.multiply(d),e.multiply(c.setFromAxisAngle(a,-i))}}()};